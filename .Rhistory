ggplot(aes(height +119, sqrt(u^2 + v^2))) +
# geom_ribbon(aes(ymin = mean.spd - sd, ymax = mean.spd + sd), alpha = 0.2) +
geom_line(aes(color = QC)) +
geom_point(aes(color = QC)) +
geom_line(data = na.omit(soundings), aes(height, spd)) +
coord_flip()
VAD %>%
copy() %>%
# .[elevation %between% c(1, 3)] %>%
.[, vad_regrid(.SD, layer_width = 100, ht.out = seq(100, 2000, 50)), by = .(QC)] %>%
ggplot(aes(height +119, sqrt(u^2 + v^2))) +
# geom_ribbon(aes(ymin = mean.spd - sd, ymax = mean.spd + sd), alpha = 0.2) +
geom_line(aes(color = QC)) +
geom_point(aes(color = QC)) +
geom_line(data = na.omit(soundings), aes(height, spd)) +
coord_flip()
VAD %>%
copy() %>%
.[r2 > 0.7] %>%
.[, vad_regrid(.SD, layer_width = 100, ht.out = seq(100, 2000, 50)), by = .(QC)] %>%
ggplot(aes(height +119, sqrt(u^2 + v^2))) +
# geom_ribbon(aes(ymin = mean.spd - sd, ymax = mean.spd + sd), alpha = 0.2) +
geom_line(aes(color = QC)) +
geom_point(aes(color = QC)) +
geom_line(data = na.omit(soundings), aes(height, spd)) +
coord_flip()
VAD %>%
copy() %>%
.[r2 > 0.6] %>%
.[, vad_regrid(.SD, layer_width = 100, ht.out = seq(100, 2000, 50)), by = .(QC)] %>%
ggplot(aes(height +119, sqrt(u^2 + v^2))) +
# geom_ribbon(aes(ymin = mean.spd - sd, ymax = mean.spd + sd), alpha = 0.2) +
geom_line(aes(color = QC)) +
geom_point(aes(color = QC)) +
geom_line(data = na.omit(soundings), aes(height, spd)) +
coord_flip()
VAD %>%
copy() %>%
.[r2 > 0.7] %>%
.[, vad_regrid(.SD, layer_width = 100, ht.out = seq(100, 2000, 50)), by = .(QC)] %>%
ggplot(aes(height +119, sqrt(u^2 + v^2))) +
# geom_ribbon(aes(ymin = mean.spd - sd, ymax = mean.spd + sd), alpha = 0.2) +
geom_line(aes(color = QC)) +
geom_point(aes(color = QC)) +
geom_line(data = na.omit(soundings), aes(height, spd)) +
coord_flip()
VAD %>%
copy() %>%
.[r2 > 0.8] %>%
.[, vad_regrid(.SD, layer_width = 100, ht.out = seq(100, 2000, 50)), by = .(QC)] %>%
ggplot(aes(height +119, sqrt(u^2 + v^2))) +
# geom_ribbon(aes(ymin = mean.spd - sd, ymax = mean.spd + sd), alpha = 0.2) +
geom_line(aes(color = QC)) +
geom_point(aes(color = QC)) +
geom_line(data = na.omit(soundings), aes(height, spd)) +
coord_flip()
VAD %>%
copy() %>%
.[r2 > 0.9] %>%
.[, vad_regrid(.SD, layer_width = 100, ht.out = seq(100, 2000, 50)), by = .(QC)] %>%
ggplot(aes(height +119, sqrt(u^2 + v^2))) +
# geom_ribbon(aes(ymin = mean.spd - sd, ymax = mean.spd + sd), alpha = 0.2) +
geom_line(aes(color = QC)) +
geom_point(aes(color = QC)) +
geom_line(data = na.omit(soundings), aes(height, spd)) +
coord_flip()
VAD %>%
copy() %>%
# .[r2 > 0.9] %>%
.[, vad_regrid(.SD, layer_width = 100, ht.out = seq(100, 2000, 50)), by = .(QC)] %>%
ggplot(aes(height +119, sqrt(u^2 + v^2))) +
# geom_ribbon(aes(ymin = mean.spd - sd, ymax = mean.spd + sd), alpha = 0.2) +
geom_line(aes(color = QC)) +
geom_point(aes(color = QC)) +
geom_line(data = na.omit(soundings), aes(height, spd)) +
coord_flip()
knitr::opts_chunk$set(echo = TRUE)
library(rvad)
library(ggplot2)
library(data.table)
library(metR)
library(dplyr)
library(patchwork)
library(stringr)
library(lubridate)
radial_wind <- ReadNetCDF("../VAD/RMA4/QC/cfrad.20181121_105940.RMA4_0200_02.nc", vars = c("CVRAD", "azimuth", "elevation"))
na.omit(radial_wind) %>%
ggplot(aes(azimuth, range)) +
geom_point(aes(color = CVRAD, size = range)) +
scale_size_area(max_size = 0.5) +
scale_color_divergent() +
coord_polar() +
facet_wrap(~elevation, ncol = 4)
radial_wind <- ReadNetCDF("../VAD/RMA4/QC/cfrad.20181121_11.nc", vars = c("CVRAD", "azimuth", "elevation"))
radial_wind <- ReadNetCDF("../VAD/RMA4/QC/cfrad.20181121_105940.RMA4_0200_02.nc", vars = c("CVRAD", "azimuth", "elevation"))
with_QC <- with(radial_wind, vad_fit(CVRAD, azimuth, range, elevation, r2 = 0.5)) %>%
setDT() %>%
.[, `:=`(spd = sqrt(u^2 + v^2), QC = "QC")]
radial_wind <- ReadNetCDF("../VAD/RMA4/cfrad.20181121_110832.0000_to_20181121_111113.0000_RMA4_0200_02.nc", vars = c("Vda", "azimuth", "elevation"))
without_QC <- with(radial_wind, vad_fit(Vda, azimuth, range, elevation, r2 = 0.5)) %>%
setDT() %>%
.[, `:=`(spd = sqrt(u^2 + v^2), QC = "no QC")]
VAD <- rbind(with_QC, without_QC)
VAD %>%
ggplot(aes(spd, height)) +
geom_point(aes(color = factor(elevation))) +
coord_cartesian(xlim = c(0, 15), ylim = c(0, 2000)) +
facet_wrap(~QC) +
VAD %>%
ggplot(aes(spd, height)) +
geom_point(aes(color = r2)) +
coord_cartesian(xlim = c(0, 15), ylim = c(0, 2000)) +
facet_wrap(~QC) +
plot_layout(ncol = 1)
radial_wind <- ReadNetCDF("../VAD/RMA4/QC/cfrad.20181121_105940.RMA4_0200_02.nc", vars = c("CVRAD", "azimuth", "elevation"))
with_QC <- with(radial_wind, vad_fit(CVRAD, azimuth, range, elevation, r2 = 0.5)) %>%
setDT() %>%
.[, `:=`(spd = sqrt(u^2 + v^2), QC = "QC")]
radial_wind <- ReadNetCDF("../VAD/RMA4/cfrad.20181121_110832.0000_to_20181121_111113.0000_RMA4_0200_02.nc", vars = c("Vda", "azimuth", "elevation"))
without_QC <- with(radial_wind, vad_fit(Vda, azimuth, range, elevation, r2 = 0.5)) %>%
setDT() %>%
.[, `:=`(spd = sqrt(u^2 + v^2), QC = "no QC")]
VAD <- rbind(with_QC, without_QC)
VAD %>%
ggplot(aes(spd, height)) +
geom_point(aes(color = factor(elevation))) +
coord_cartesian(xlim = c(0, 15), ylim = c(0, 2000)) +
facet_wrap(~QC) +
VAD %>%
ggplot(aes(spd, height)) +
geom_point(aes(color = r2)) +
coord_cartesian(xlim = c(0, 15), ylim = c(0, 2000)) +
facet_wrap(~QC) +
plot_layout(ncol = 1)
soundings <- fread("data/soundings_wyoming_87155.csv") %>%
.[, time := as_datetime(time)] %>%
.[time  == as_datetime("20181121120000")]
VAD %>%
copy() %>%
.[r2 > 0.8] %>%
# .[elevation %between% c(0, 1)] %>%
.[, vad_regrid(.SD, layer_width = 50, ht.out = seq(100, 2000, 20)), by = .(QC)] %>%
ggplot(aes(height +119, sqrt(u^2 + v^2))) +
# geom_ribbon(aes(ymin = mean.spd - sd, ymax = mean.spd + sd), alpha = 0.2) +
geom_line(aes(color = QC)) +
geom_point(aes(color = QC)) +
geom_line(data = na.omit(soundings), aes(height, spd)) +
geom_point(data = na.omit(soundings), aes(height, spd)) +
coord_flip(ylim = c(0, 25))
VAD %>%
copy() %>%
.[r2 > 0.8] %>%
# .[elevation %between% c(0, 1)] %>%
.[, vad_regrid(.SD, layer_width = 50, ht.out = seq(100, 2000, 20)), by = .(QC)] %>%
ggplot(aes(height +119, 180+atan2(u, v)*180/pi)) +
# geom_ribbon(aes(ymin = mean.spd - sd, ymax = mean.spd + sd), alpha = 0.2) +
# geom_line(aes(color = QC)) +
geom_point(aes(color = QC)) +
# geom_line(data = na.omit(soundings), aes(height, dir)) +
geom_point(data = na.omit(soundings), aes(height, dir)) +
coord_flip()
knitr::opts_chunk$set(echo = TRUE)
library(rvad)
library(ggplot2)
library(data.table)
library(metR)
library(dplyr)
library(patchwork)
library(stringr)
library(lubridate)
radial_wind <- ReadNetCDF("../VAD/RMA4/QC/cfrad.20181121_105940.RMA4_0200_02.nc", vars = c("Vda", "azimuth", "elevation"))
radial_wind <- ReadNetCDF("../VAD/RMA4/cfrad.20181121_105940.0000_to_20181121_110221.0000_RMA4_0200_02.nc", vars = c("Vda", "azimuth", "elevation"))
radial_wind
GlanceNetCDF("../VAD/RMA4/cfrad.20181121_105940.0000_to_20181121_110221.0000_RMA4_0200_02.nc")
146790-1740
(146790-1740)/968
radial_wind
diff(radial_wind$range)
a <- GlanceNetCDF("../VAD/RMA4/cfrad.20181121_105940.0000_to_20181121_110221.0000_RMA4_0200_02.nc")
a$dims$range$name
a$dims$range$vals
a$dims$range$create_dimvar
a$dims$range$units
a$dims$range$group_id
a$dims$range$id
a$vars$Vda$dimids
radial_wind <- ReadNetCDF("../VAD/RMA4/cfrad.20181121_105940.0000_to_20181121_110221.0000_RMA4_0200_02.nc", vars = c("Vda", "azimuth", "elevation")) %>%
setDT()
radial_wind
radial_wind %>%
.[`:=`(elev_inf = elevation - 0.5,
elev_sup = elevation + 0.5,
range_ini = range - 75,
range_fin = range + 75)]
radial_wind %>%
.[, `:=`(elev_inf = elevation - 0.5,
elev_sup = elevation + 0.5,
range_ini = range - 75,
range_fin = range + 75)]
radial_wind
radial_wind %>%
.[, `:=`(elev_inf = elevation - 0.5,
elev_sup = elevation + 0.5,
range_ini = range - 75,
range_fin = range + 75)] %>%
.[, `:=`(hg_inf = beam_propagation(range_ini, elev_inf),
hg_sup = beam_propagation(range_fin, elev_sup))]
radial_wind %>%
.[, `:=`(elev_inf = elevation - 0.5,
elev_sup = elevation + 0.5,
range_ini = range - 75,
range_fin = range + 75)] %>%
.[, `:=`(hg_inf = beam_propagation(range_ini, elev_inf)[["ht"]],
hg_sup = beam_propagation(range_fin, elev_sup)[["ht"]])]
radial_wind
radial_wind %>%
.[, `:=`(elev_inf = elevation - 0.5,
elev_sup = elevation + 0.5,
range_ini = range - 75,
range_fin = range + 75)] %>%
.[, `:=`(hg_inf = beam_propagation(range_ini, elev_inf)[["ht"]],
hg_sup = beam_propagation(range_fin, elev_sup)[["ht"]])] %>%
.[, z := hg_sup - hg_inf]
radial_wind
radial_wind <- ReadNetCDF("../VAD/RMA4/cfrad.20181121_105940.0000_to_20181121_110221.0000_RMA4_0200_02.nc", vars = c("Vda", "azimuth", "elevation")) %>%
setDT()
VAD <- with(radial_wind, vad_fit(CVRAD, azimuth, range, elevation, r2 = 0.5)))
VAD <- with(radial_wind, vad_fit(Vda, azimuth, range, elevation, r2 = 0.5)))
VAD <- with(radial_wind, vad_fit(Vda, azimuth, range, elevation, r2 = 0.5))
VAD
VAD <- with(radial_wind, vad_fit(Vda, azimuth, range, elevation, r2 = 0.5)) %>%
setDT()
VAD %>%
.[, `:=`(elev_inf = elevation - 0.5,
elev_sup = elevation + 0.5,
range_ini = range - 75,
range_fin = range + 75)] %>%
.[, `:=`(hg_inf = beam_propagation(range_ini, elev_inf)[["ht"]],
hg_sup = beam_propagation(range_fin, elev_sup)[["ht"]])] %>%
.[, dz := hg_sup - hg_inf]
VAD
VAD <- with(radial_wind, vad_fit(Vda, azimuth, range, elevation, r2 = 0.5)) %>%
setDT()
VAD %>%
.[, spd := sqrt(u^2 + v^2)] %>%
.[, `:=`(elev_inf = elevation - 0.5,
elev_sup = elevation + 0.5,
range_ini = range - 75,
range_fin = range + 75)] %>%
.[, `:=`(hg_inf = beam_propagation(range_ini, elev_inf)[["ht"]],
hg_sup = beam_propagation(range_fin, elev_sup)[["ht"]])] %>%
.[, dz := hg_sup - hg_inf]
knitr::opts_chunk$set(echo = TRUE)
library(rvad)
library(ggplot2)
library(data.table)
library(metR)
library(dplyr)
library(patchwork)
library(stringr)
library(lubridate)
VAD %>%
na.omit() %>%
ggplot(aes(spd, dz)) +
geom_point(aes(color = factor(elevation))) +
geom_smooth(method = lm, aes(group = factor(elevation), color = factor(elevation))) +
scale_color_discrete(name = "Elevación") +
facet_wrap(~height_cut, scales = "free")
VAD %>%
na.omit() %>%
ggplot(aes(spd, dz)) +
geom_point(aes(color = factor(elevation))) +
geom_smooth(method = lm, aes(group = factor(elevation), color = factor(elevation))) +
scale_color_discrete(name = "Elevación")
VAD[, height_cut := cut_width(height, 200)] %>%
na.omit() %>%
ggplot(aes(spd, dz)) +
geom_point(aes(color = factor(elevation))) +
geom_smooth(method = lm, aes(group = factor(elevation), color = factor(elevation))) +
scale_color_discrete(name = "Elevación") +
facet_wrap(~height_cut)
VAD[, height_cut := cut_width(height, 200)] %>%
na.omit() %>%
ggplot(aes(spd, dz)) +
geom_point(aes(color = factor(elevation))) +
geom_smooth(method = lm, aes(group = factor(elevation), color = factor(elevation))) +
scale_color_discrete(name = "Elevación") +
facet_wrap(~height_cut, scales = "free")
VAD[, height_cut := cut_width(height, 200)] %>%
na.omit() %>%
ggplot(aes(spd, range)) +
geom_point(aes(color = factor(elevation))) +
geom_smooth(method = lm, aes(group = factor(elevation), color = factor(elevation))) +
scale_color_discrete(name = "Elevación") +
facet_wrap(~height_cut, scales = "free")
VAD[, height_cut := cut_width(height, 200)] %>%
na.omit() %>%
ggplot(aes(spd, range)) +
geom_point() +
geom_smooth(method = lm) +
scale_color_discrete(name = "Elevación") +
facet_wrap(~height_cut, scales = "free")
VAD[, height_cut := cut_width(height, 200)] %>%
na.omit() %>%
ggplot(aes(spd, dz)) +
geom_point() +
geom_smooth(method = lm) +
scale_color_discrete(name = "Elevación") +
facet_wrap(~height_cut, scales = "free")
na.omit(VAD) %>%
.[, FitLm(spd, dz, se = TRUE), by = .(elevation, cut_width(height, 200))] %>%
.[term == "dz"] %>%
ggplot(aes(estimate, cut_width)) +
geom_vline(xintercept = 0, color = "darkgray") +
geom_point(aes(color = factor(elevation), size = df)) +
geom_path(aes(group = factor(elevation), color = factor(elevation))) +
scale_color_discrete(name = "Elevación") +
scale_size(name = "Grados de \nlibertad") +
labs("Relación entre la velocidad y la distancia", x = "Pendiente (m/s*km)", y = "Capas (m)") +
# geom_errorbarh(aes(xmin = estimate - std.error*2, xmax = estimate + std.error*2)) +
theme(legend.position = "bottom")
geom_path(aes() +
.[term == "dz"] %>%
na.omit(VAD) %>%
na.omit(VAD) %>%
VAD
na.omit(VAD) %>%
.[, FitLm(spd, dz, se = TRUE), by = .(cut_width(height, 200))] %>%
.[term == "dz"] %>%
ggplot(aes(estimate, cut_width)) +
geom_vline(xintercept = 0, color = "darkgray") +
geom_point(aes(size = df)) +
geom_path() +
scale_size(name = "Grados de \nlibertad") +
labs("Relación entre la velocidad y la distancia", x = "Pendiente (m/s*km)", y = "Capas (m)") +
# geom_errorbarh(aes(xmin = estimate - std.error*2, xmax = estimate + std.error*2)) +
theme(legend.position = "bottom")
VAD <- with(radial_wind, vad_fit(Vda, azimuth, range, elevation, r2 = 0.8)) %>%
setDT()
VAD %>%
.[, spd := sqrt(u^2 + v^2)] %>%
.[, `:=`(elev_inf = elevation - 0.5,
elev_sup = elevation + 0.5,
range_ini = range - 75,
range_fin = range + 75)] %>%
.[, `:=`(hg_inf = beam_propagation(range_ini, elev_inf)[["ht"]],
hg_sup = beam_propagation(range_fin, elev_sup)[["ht"]])] %>%
.[, dz := hg_sup - hg_inf]
VAD[, height_cut := cut_width(height, 200)] %>%
na.omit() %>%
ggplot(aes(spd, dz)) +
geom_point() +
geom_smooth(method = lm) +
scale_color_discrete(name = "Elevación") +
facet_wrap(~height_cut, scales = "free")
na.omit(VAD) %>%
.[, FitLm(spd, dz, se = TRUE), by = .(cut_width(height, 200))] %>%
.[term == "dz"] %>%
ggplot(aes(estimate, cut_width)) +
geom_vline(xintercept = 0, color = "darkgray") +
geom_point(aes(size = df)) +
geom_path() +
scale_size(name = "Grados de \nlibertad") +
labs("Relación entre la velocidad y la distancia", x = "Pendiente (m/s*km)", y = "Capas (m)") +
# geom_errorbarh(aes(xmin = estimate - std.error*2, xmax = estimate + std.error*2)) +
theme(legend.position = "bottom")
rvad:::plot.rvad_vad(VAD)
devtools::install_github("paocorrales/rvad")
knitr::opts_chunk$set(echo = TRUE)
library(rvad)
library(ggplot2)
library(data.table)
library(metR)
library(dplyr)
library(patchwork)
library(stringr)
library(lubridate)
radial_wind <- ReadNetCDF("../VAD/RMA4/cfrad.20181121_105940.0000_to_20181121_110221.0000_RMA4_0200_02.nc", vars = c("Vda", "azimuth", "elevation")) %>%
setDT()
VAD <- with(radial_wind, vad_fit(Vda, azimuth, range, elevation, r2 = 0.8, outlier_threshold = 3)) %>%
setDT()
VAD %>%
.[, spd := sqrt(u^2 + v^2)] %>%
.[, `:=`(elev_inf = elevation - 0.5,
elev_sup = elevation + 0.5,
range_ini = range - 75,
range_fin = range + 75)] %>%
.[, `:=`(hg_inf = beam_propagation(range_ini, elev_inf)[["ht"]],
hg_sup = beam_propagation(range_fin, elev_sup)[["ht"]])] %>%
.[, dz := hg_sup - hg_inf]
VAD[, height_cut := cut_width(height, 200)] %>%
na.omit() %>%
ggplot(aes(spd, dz)) +
geom_point() +
geom_smooth(method = lm) +
scale_color_discrete(name = "Elevación") +
facet_wrap(~height_cut, scales = "free")
na.omit(VAD) %>%
.[, FitLm(spd, dz, se = TRUE), by = .(cut_width(height, 200))] %>%
.[term == "dz"] %>%
ggplot(aes(estimate, cut_width)) +
geom_vline(xintercept = 0, color = "darkgray") +
geom_point(aes(size = df)) +
geom_path() +
scale_size(name = "Grados de \nlibertad") +
labs("Relación entre la velocidad y la distancia", x = "Pendiente (m/s*km)", y = "Capas (m)") +
# geom_errorbarh(aes(xmin = estimate - std.error*2, xmax = estimate + std.error*2)) +
theme(legend.position = "bottom")
rvad:::plot.rvad_vad(VAD)
VAD[, height_cut := cut_width(height, 200)] %>%
na.omit() %>%
ggplot(aes(spd, dz)) +
geom_point(aes(color = factor(elevation))) +
geom_smooth(method = lm) +
scale_color_discrete(name = "Elevación") +
facet_wrap(~height_cut, scales = "free")
VAD[, height_cut := cut_width(height, 200)] %>%
na.omit() %>%
ggplot(aes(spd, dz)) +
geom_point(aes(color = factor(elevation))) +
geom_smooth(method = lm) +
scale_color_discrete(name = "Elevación") +
facet_wrap(~height_cut, scales = "free")
ggplot(VAD, aes(range, dz))
ggplot(VAD, aes(range, dz)) + geom_point()
ggplot(VAD, aes(range, dz)) + geom_point(aes(color = factor(elevation)))
ggplot(VAD, aes(spd, dz)) + geom_point(aes(color = factor(elevation)))
ggplot(VAD, aes(range, dz)) + geom_point(aes(color = factor(elevation)))
ggplot(VAD, aes(spd, range) + geom_point(aes(color = factor(elevation)))
ggplot(VAD, aes(spd, range)) + geom_point(aes(color = factor(elevation)))
ggplot(VAD, aes(spd, dz)) + geom_point(aes(color = factor(elevation)))
knitr::opts_chunk$set(echo = TRUE)
library(rvad)
library(ggplot2)
library(data.table)
library(metR)
library(dplyr)
library(patchwork)
library(stringr)
library(lubridate)
radial_wind <- ReadNetCDF("../VAD/RMA4/cfrad.20181121_105940.0000_to_20181121_110221.0000_RMA4_0200_02.nc", vars = c("Vda", "azimuth", "elevation")) %>%
setDT()
radial_wind %>%
.[, vad_fit(Vda, azimuth, range, elevation, outlier_threshold = 3)] %>%
as.data.table()
radial_wind %>%
.[, vad_fit(Vda, azimuth, range, elevation, outlier_threshold = 3)] %>%
as.data.table() -> VAD
VAD[, ":="(dh = c(NA, diff(height)),
du = c(NA, diff(u)),
dv = c(NA, diff(v))),
by = .(elevation)]
VAD
VAD[, ":="(dh = c(NA, diff(height)),
du = c(NA, diff(u)),
dv = c(NA, diff(v))),
by = .(elevation)] %>%
.[, ":="(du_dh = du/dh,
dv_dh = dv/dh)]
VAD
VAD %>%
ggplot(aes(du_dh, height)) +
geom_path(aes(color = factor(elevation)))
VAD[height < 2000] %>%
ggplot(aes(du_dh, height)) +
geom_path(aes(color = factor(elevation)))
VAD[height < 2000] %>%
ggplot(aes(abs(du_dh), height)) +
geom_path(aes(color = factor(elevation)))
VAD[height < 2000] %>%
ggplot(aes(sqrt(u^2 + v^2), height)) +
geom_point(aes(color = factor(elevation), size = du_dh))
VAD[height < 2000] %>%
ggplot(aes(sqrt(u^2 + v^2), height)) +
geom_point(aes(color = factor(elevation), size = abs(du_dh))) +
scale_color_viridis_d()
VAD[height < 2000] %>%
ggplot(aes(sqrt(u^2 + v^2), height)) +
geom_point(aes(color = factor(elevation), size = abs(dv_dh))) +
scale_color_viridis_d()
VAD[, V := sqrt(u^2 + u^2)] %>%
.[, ":="(dh = c(NA, diff(height)),
du = c(NA, diff(u)),
dv = c(NA, diff(v)),
dV = c(NA, diff(V))),
by = .(elevation)] %>%
.[, ":="(du_dh = du/dh,
dv_dh = dv/dh,
dV_dh = dV/dh)]
VAD[height < 2000] %>%
ggplot(aes(abs(dV_dh), height)) +
geom_path(aes(color = factor(elevation)))
VAD[height < 2000] %>%
ggplot(aes(V, height)) +
geom_point(aes(color = factor(elevation), size = abs(dV_dh))) +
scale_color_viridis_d()
VAD[, V := sqrt(u^2 + v^2)] %>%
.[, ":="(dh = c(NA, diff(height)),
du = c(NA, diff(u)),
dv = c(NA, diff(v)),
dV = c(NA, diff(V))),
by = .(elevation)] %>%
.[, ":="(du_dh = du/dh,
dv_dh = dv/dh,
dV_dh = dV/dh)]
VAD[height < 2000] %>%
ggplot(aes(abs(dV_dh), height)) +
geom_path(aes(color = factor(elevation)))
VAD[height < 2000] %>%
ggplot(aes(V, height)) +
geom_point(aes(color = factor(elevation), size = abs(dV_dh))) +
scale_color_viridis_d()
